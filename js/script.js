'use strict';

$(function () {

	// Главный слайдер 
	function introSlider(data) {
		var autoPlaySlides = data.autoPlay || false,
		    autoPlaySlidesSpeed = data.autoPlaySpeed || 1000,
		    slider = $(data.slider),
		    controls = $(slider).find('.controls').get(0);

		function autoPlay(seconds) {
			setInterval(function () {
				$(controls).find('.controls__arrow_next').trigger('click');
			}, seconds);
		}

		// Счётчик слайдов
		function count() {
			var count = $(controls).find('.controls__count'),
			    slides = $(slider).find('.intro__slide').length,
			    active = $(slider).find('.intro__slide.active').index() + 1;

			$(count).text(active + ' / ' + slides).addClass('change');
			setTimeout(function () {
				$(count).removeClass('change');
			}, 100);
		}

		// Следующий слайд
		function nextSlide() {
			var next = $(slider).find('.intro__slide.active').next().get(0) == undefined ? $(slider).find('.intro__slide').first().get(0) : $(slider).find('.intro__slide.active').next().get(0);
			activeContent(next);
		}

		// Предыдущий слайд
		function prevSlide() {
			var prev = $(slider).find('.intro__slide.active').prev().get(0) === undefined ? $(slider).find('.intro__slide').last() : $(slider).find('.intro__slide.active').prev().get(0);
			activeContent(prev);
		}

		// Замена контента
		function activeContent(slide) {
			var active = slide ? slide : $(slider).find('.intro__slide.active'),
			    contentSlide = $(active).find('.intro__slide-content').html(),
			    content = $(slider).find('.intro__content'),
			    link = $(active).data('link'),
			    altSlide = $(active).find('.intro__slide-alt').html(),
			    alt = $(slider).find('.intro__alt');

			$(slider).find('.intro__slide.active').removeClass('active');
			$(active).addClass('active');

			$(content).addClass('change').html(contentSlide);
			$(slider).find('.intro__more').attr('href', link);

			$(alt).addClass('change');

			count();

			setTimeout(function () {
				$(alt).removeClass('change').empty().append(altSlide);
				var gallery = $(alt).find('.gallery').get(0);

				if (gallery) {
					$(gallery).find('.gallery__slides').slick({
						infinite: true,
						autoplay: 3000,
						slidesToShow: 1,
						arrows: true,
						fade: true,
						prevArrow: $('.controls_gallery .controls__arrow_prev'),
						nextArrow: $('.controls_gallery .controls__arrow_next')
					});
				}
			}, 500);

			setTimeout(function () {
				$(content).removeClass('change');
			}, 300);
		}

		$(slider).find('.intro__slide').first().addClass('active');

		activeContent();

		$(slider).find('.controls__arrow').on('click', function () {
			var direction = $(this).hasClass('controls__arrow_next');

			switch (direction) {
				case true:
					nextSlide();
					break;
				case false:
					prevSlide();
					break;
			}
		});

		if (autoPlaySlides) autoPlay(autoPlaySlidesSpeed);
	}

	introSlider({
		slider: $('[data-slider="intro"]'),
		autoPlay: true,
		autoPlaySpeed: 5000
	});

	introSlider({
		slider: $('[data-slider="specialists"]')
	});

	function brandsSlider() {
		function refresh() {
			var slides = $('.brands__list .brand').children().length + 1,
			    current = $('.brand.slick-current'),
			    index = $(current).index() + 1,
			    img = $(current).data('image'),
			    image = $('.brands__image');

			if (String(slides).length === 1) slides = '0' + slides;
			if (String(index).length === 1) index = '0' + index;

			$('.brands__count span').first().text(index);
			$('.brands__count span').last().text(slides);

			$(image).addClass('change');

			setTimeout(function () {
				$(image).css({
					'background-image': 'url(' + img + ')'
				});
				$(image).removeClass('change');
			}, 100);
		}

		$('.brands__list').slick({
			infinite: true,
			fade: true,
			arrows: true,
			prevArrow: $('.controls_brands .controls__arrow_prev'),
			nextArrow: $('.controls_brands .controls__arrow_next')
		});

		$('.controls_brands .controls__arrow').on('click', refresh);

		refresh();
	}

	brandsSlider();

	function gallery() {
		$('.gallery').each(function (i, gallery) {
			if ($(gallery).hasClass('gallery_spec')) return;

			$(gallery).find('.gallery__slides').slick({
				infinite: true,
				autoplay: 3000,
				slidesToShow: 1,
				arrows: true,
				fade: true,
				prevArrow: $('.controls_gallery .controls__arrow_prev'),
				nextArrow: $('.controls_gallery .controls__arrow_next')
			});

			function titleSetup(title) {
				var delay = 150;

				$(titles).fadeOut(delay, function () {
					$(this).html(title).fadeIn(delay);
				});
			}

			var titles = $(gallery).find('.gallery__title').get(0);

			if (titles) {
				var title = $(gallery).find('.slick-current').data('title');
				titleSetup(title);

				$(gallery).find('.gallery__slides').on('beforeChange', function (e, slick, currentSlide, nextSlide) {
					var index = nextSlide,
					    slide = $(gallery).find('.gallery__item').get(index),
					    title = $(slide).data('title');

					titleSetup(title);
				});
			}
		});
	}

	gallery();

	// Простые слайдеры
	$('.slider').each(function (i, slider) {
		var sl = $(slider).find('.slider__list');

		sl.slick({
			variableWidth: true,
			centerMode: true,
			arrows: true,
			prevArrow: $(slider).find('.controls__arrow_prev'),
			nextArrow: $(slider).find('.controls__arrow_next')
		});

		var bigImg = $(slider).data('bigimg');

		if (bigImg) {
			var big = $('.' + bigImg).get(0);

			$(big).html($(sl).find('.slick-current img').clone());

			$(sl).on('.slider__item').on('click', function (e) {
				e.preventDefault();

				var img = $(this).find('img').clone();

				$(big).empty().html(img);
			});
		}
	});

	// bpopup
	$('[data-bpopup]').on('click', function (e) {
		e.preventDefault();

		var img = $(this).find('img').clone(),
		    imgWrap = '<div class="bpopup-wrap-image"></div>';

		$('body').append(imgWrap);
		$(imgWrap).append(img).bPopup().reposition(300);
	});

	// Карта
	var map = $('#map').get(0);

	if (map) {
		var init = function init() {
			myMap = new ymaps.Map("map", {
				center: [53.334136, 83.793247],
				zoom: 17,
				controls: []
			});

			myPlacemark = new ymaps.Placemark([53.334136, 83.793247], {
				hintContent: 'ТД Ultra'
			});

			myMap.geoObjects.add(myPlacemark);
		};

		ymaps.ready(init);

		var myMap, myPlacemark;
	}

	// Красивые селекты
	$('select').niceSelect();

	// Мобильное меню
	$('.menu').on('click', function () {
		$(this).parent().toggleClass('menu-open');
	});

	// Модальные окна
	$('[data-open]').on('click', function (e) {
		e.preventDefault();

		var modal = $('[data-modal="' + $(this).data('open') + '"]').get(0);

		$(modal).bPopup({
			closeClass: 'modal__close'
		});
	});

	// Поиск
	searchComponent();

	function searchComponent() {
		var search = $('.search');

		$('.search__btn').on('click', function () {
			if ($(window).width() > 768) return;

			$(search).toggleClass('search-open');
			$(search).find('input').focus();
		});

		$('.search__clear').on('click', function () {
			$(search).find('.search__field input').val('').focus();
		});
	}

	// Сравнение
	$('.result__compare').twentytwenty({
		before_label: 'До',
		after_label: 'После'
	});

	// tilt js
	$('.sertificate').tilt();

	// Плавающая шапка
	$('body').append($('.header__main').clone().addClass('fixed'));

	$(window).on('scroll', function () {
		if ($(window).width() <= 1000) {
			$('.header__main.fixed.show').removeClass('show');
			return;
		}

		var scroll = $(window).scrollTop();

		if (scroll >= 200) {
			$('.header__main.fixed').addClass('show');
		} else {
			$('.header__main.fixed.show').removeClass('show');
		}
	});
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdC5qcyJdLCJuYW1lcyI6WyIkIiwiaW50cm9TbGlkZXIiLCJkYXRhIiwiYXV0b1BsYXlTbGlkZXMiLCJhdXRvUGxheSIsImF1dG9QbGF5U2xpZGVzU3BlZWQiLCJhdXRvUGxheVNwZWVkIiwic2xpZGVyIiwiY29udHJvbHMiLCJmaW5kIiwiZ2V0Iiwic2Vjb25kcyIsInNldEludGVydmFsIiwidHJpZ2dlciIsImNvdW50Iiwic2xpZGVzIiwibGVuZ3RoIiwiYWN0aXZlIiwiaW5kZXgiLCJ0ZXh0IiwiYWRkQ2xhc3MiLCJzZXRUaW1lb3V0IiwicmVtb3ZlQ2xhc3MiLCJuZXh0U2xpZGUiLCJuZXh0IiwidW5kZWZpbmVkIiwiZmlyc3QiLCJhY3RpdmVDb250ZW50IiwicHJldlNsaWRlIiwicHJldiIsImxhc3QiLCJzbGlkZSIsImNvbnRlbnRTbGlkZSIsImh0bWwiLCJjb250ZW50IiwibGluayIsImFsdFNsaWRlIiwiYWx0IiwiYXR0ciIsImVtcHR5IiwiYXBwZW5kIiwiZ2FsbGVyeSIsInNsaWNrIiwiaW5maW5pdGUiLCJhdXRvcGxheSIsInNsaWRlc1RvU2hvdyIsImFycm93cyIsImZhZGUiLCJwcmV2QXJyb3ciLCJuZXh0QXJyb3ciLCJvbiIsImRpcmVjdGlvbiIsImhhc0NsYXNzIiwiYnJhbmRzU2xpZGVyIiwicmVmcmVzaCIsImNoaWxkcmVuIiwiY3VycmVudCIsImltZyIsImltYWdlIiwiU3RyaW5nIiwiY3NzIiwiZWFjaCIsImkiLCJ0aXRsZVNldHVwIiwidGl0bGUiLCJkZWxheSIsInRpdGxlcyIsImZhZGVPdXQiLCJmYWRlSW4iLCJlIiwiY3VycmVudFNsaWRlIiwic2wiLCJ2YXJpYWJsZVdpZHRoIiwiY2VudGVyTW9kZSIsImJpZ0ltZyIsImJpZyIsImNsb25lIiwicHJldmVudERlZmF1bHQiLCJpbWdXcmFwIiwiYlBvcHVwIiwicmVwb3NpdGlvbiIsIm1hcCIsImluaXQiLCJteU1hcCIsInltYXBzIiwiTWFwIiwiY2VudGVyIiwiem9vbSIsIm15UGxhY2VtYXJrIiwiUGxhY2VtYXJrIiwiaGludENvbnRlbnQiLCJnZW9PYmplY3RzIiwiYWRkIiwicmVhZHkiLCJuaWNlU2VsZWN0IiwicGFyZW50IiwidG9nZ2xlQ2xhc3MiLCJtb2RhbCIsImNsb3NlQ2xhc3MiLCJzZWFyY2hDb21wb25lbnQiLCJzZWFyY2giLCJ3aW5kb3ciLCJ3aWR0aCIsImZvY3VzIiwidmFsIiwidHdlbnR5dHdlbnR5IiwiYmVmb3JlX2xhYmVsIiwiYWZ0ZXJfbGFiZWwiLCJ0aWx0Iiwic2Nyb2xsIiwic2Nyb2xsVG9wIl0sIm1hcHBpbmdzIjoiOztBQUFBQSxFQUFFLFlBQVc7O0FBRVo7QUFDQSxVQUFTQyxXQUFULENBQXFCQyxJQUFyQixFQUEyQjtBQUMxQixNQUFJQyxpQkFBaUJELEtBQUtFLFFBQUwsSUFBaUIsS0FBdEM7QUFBQSxNQUNDQyxzQkFBc0JILEtBQUtJLGFBQUwsSUFBc0IsSUFEN0M7QUFBQSxNQUVDQyxTQUFTUCxFQUFFRSxLQUFLSyxNQUFQLENBRlY7QUFBQSxNQUdDQyxXQUFXUixFQUFFTyxNQUFGLEVBQVVFLElBQVYsQ0FBZSxXQUFmLEVBQTRCQyxHQUE1QixDQUFnQyxDQUFoQyxDQUhaOztBQUtBLFdBQVNOLFFBQVQsQ0FBa0JPLE9BQWxCLEVBQTJCO0FBQzFCQyxlQUFZLFlBQVc7QUFDdEJaLE1BQUVRLFFBQUYsRUFBWUMsSUFBWixDQUFpQix1QkFBakIsRUFBMENJLE9BQTFDLENBQWtELE9BQWxEO0FBQ0EsSUFGRCxFQUVHRixPQUZIO0FBR0E7O0FBRUQ7QUFDQSxXQUFTRyxLQUFULEdBQWlCO0FBQ2hCLE9BQUlBLFFBQVFkLEVBQUVRLFFBQUYsRUFBWUMsSUFBWixDQUFpQixrQkFBakIsQ0FBWjtBQUFBLE9BQ0NNLFNBQVNmLEVBQUVPLE1BQUYsRUFBVUUsSUFBVixDQUFlLGVBQWYsRUFBZ0NPLE1BRDFDO0FBQUEsT0FFQ0MsU0FBU2pCLEVBQUVPLE1BQUYsRUFBVUUsSUFBVixDQUFlLHNCQUFmLEVBQXVDUyxLQUF2QyxLQUErQyxDQUZ6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Q0FBbUM7QUFDbENDLGdCQUFjLElBRG9CO0FBRWxDQyxlQUFhO0FBRnFCLEVBQW5DOztBQUtBO0FBQ0EzRyxHQUFFLGNBQUYsRUFBa0I0RyxJQUFsQjs7QUFFQTtBQUNBNUcsR0FBRSxNQUFGLEVBQVV3QyxNQUFWLENBQWlCeEMsRUFBRSxlQUFGLEVBQW1CNEUsS0FBbkIsR0FBMkJ4RCxRQUEzQixDQUFvQyxPQUFwQyxDQUFqQjs7QUFFQXBCLEdBQUVxRyxNQUFGLEVBQVVuRCxFQUFWLENBQWEsUUFBYixFQUF1QixZQUFXO0FBQ2pDLE1BQUlsRCxFQUFFcUcsTUFBRixFQUFVQyxLQUFWLE1BQXFCLElBQXpCLEVBQStCO0FBQzlCdEcsS0FBRSwwQkFBRixFQUE4QnNCLFdBQTlCLENBQTBDLE1BQTFDO0FBQ0E7QUFDQTs7QUFFRCxNQUFJdUYsU0FBUzdHLEVBQUVxRyxNQUFGLEVBQVVTLFNBQVYsRUFBYjs7QUFFQSxNQUFJRCxVQUFVLEdBQWQsRUFBbUI7QUFDbEI3RyxLQUFFLHFCQUFGLEVBQXlCb0IsUUFBekIsQ0FBa0MsTUFBbEM7QUFDQSxHQUZELE1BRU87QUFDTnBCLEtBQUUsMEJBQUYsRUFBOEJzQixXQUE5QixDQUEwQyxNQUExQztBQUNBO0FBQ0QsRUFiRDtBQWVBLENBbFVEIiwiZmlsZSI6InNjcmlwdC5qcyIsInNvdXJjZXNDb250ZW50IjpbIiQoZnVuY3Rpb24oKSB7XG5cblx0Ly8g0JPQu9Cw0LLQvdGL0Lkg0YHQu9Cw0LnQtNC10YAgXG5cdGZ1bmN0aW9uIGludHJvU2xpZGVyKGRhdGEpIHtcblx0XHR2YXIgYXV0b1BsYXlTbGlkZXMgPSBkYXRhLmF1dG9QbGF5IHx8IGZhbHNlLFxuXHRcdFx0YXV0b1BsYXlTbGlkZXNTcGVlZCA9IGRhdGEuYXV0b1BsYXlTcGVlZCB8fCAxMDAwLFxuXHRcdFx0c2xpZGVyID0gJChkYXRhLnNsaWRlciksXG5cdFx0XHRjb250cm9scyA9ICQoc2xpZGVyKS5maW5kKCcuY29udHJvbHMnKS5nZXQoMCk7XG5cblx0XHRmdW5jdGlvbiBhdXRvUGxheShzZWNvbmRzKSB7XG5cdFx0XHRzZXRJbnRlcnZhbChmdW5jdGlvbigpIHtcblx0XHRcdFx0JChjb250cm9scykuZmluZCgnLmNvbnRyb2xzX19hcnJvd19uZXh0JykudHJpZ2dlcignY2xpY2snKTtcblx0XHRcdH0sIHNlY29uZHMpO1xuXHRcdH1cblxuXHRcdC8vINCh0YfRkdGC0YfQuNC6INGB0LvQsNC50LTQvtCyXG5cdFx0ZnVuY3Rpb24gY291bnQoKSB7XG5cdFx0XHR2YXIgY291bnQgPSAkKGNvbnRyb2xzKS5maW5kKCcuY29udHJvbHNfX2NvdW50JyksXG5cdFx0XHRcdHNsaWRlcyA9ICQoc2xpZGVyKS5maW5kKCcuaW50cm9fX3NsaWRlJykubGVuZ3RoLFxuXHRcdFx0XHRhY3RpdmUgPSAkKHNsaWRlcikuZmluZCgnLmludHJvX19zbGlkZS5hY3RpdmUnKS5pbmRleCgpKzE7XG5cblx0XHRcdCQoY291bnQpLnRleHQoYWN0aXZlKycgLyAnK3NsaWRlcykuYWRkQ2xhc3MoJ2NoYW5nZScpO1xuXHRcdFx0c2V0VGltZW91dChmdW5jdGlvbigpIHtcblx0XHRcdFx0JChjb3VudCkucmVtb3ZlQ2xhc3MoJ2NoYW5nZScpO1xuXHRcdFx0fSwgMTAwKVxuXHRcdH1cblxuXHRcdC8vINCh0LvQtdC00YPRjtGJ0LjQuSDRgdC70LDQudC0XG5cdFx0ZnVuY3Rpb24gbmV4dFNsaWRlKCkge1xuXHRcdFx0dmFyIG5leHQgPSAoJChzbGlkZXIpLmZpbmQoJy5pbnRyb19fc2xpZGUuYWN0aXZlJykubmV4dCgpLmdldCgwKSA9PSB1bmRlZmluZWQpID8gJChzbGlkZXIpLmZpbmQoJy5pbnRyb19fc2xpZGUnKS5maXJzdCgpLmdldCgwKSA6ICQoc2xpZGVyKS5maW5kKCcuaW50cm9fX3NsaWRlLmFjdGl2ZScpLm5leHQoKS5nZXQoMCk7XG5cdFx0XHRhY3RpdmVDb250ZW50KG5leHQpO1xuXHRcdH1cblxuXHRcdC8vINCf0YDQtdC00YvQtNGD0YnQuNC5INGB0LvQsNC50LRcblx0XHRmdW5jdGlvbiBwcmV2U2xpZGUoKSB7XG5cdFx0XHR2YXIgcHJldiA9ICgkKHNsaWRlcikuZmluZCgnLmludHJvX19zbGlkZS5hY3RpdmUnKS5wcmV2KCkuZ2V0KDApID09PSB1bmRlZmluZWQpID8gJChzbGlkZXIpLmZpbmQoJy5pbnRyb19fc2xpZGUnKS5sYXN0KCkgOiAkKHNsaWRlcikuZmluZCgnLmludHJvX19zbGlkZS5hY3RpdmUnKS5wcmV2KCkuZ2V0KDApO1xuXHRcdFx0YWN0aXZlQ29udGVudChwcmV2KTtcblx0XHR9XG5cblx0XHQvLyDQl9Cw0LzQtdC90LAg0LrQvtC90YLQtdC90YLQsFxuXHRcdGZ1bmN0aW9uIGFjdGl2ZUNvbnRlbnQoc2xpZGUpIHtcblx0XHRcdHZhciBhY3RpdmUgPSAoc2xpZGUpID8gc2xpZGUgOiAkKHNsaWRlcikuZmluZCgnLmludHJvX19zbGlkZS5hY3RpdmUnKSxcblx0XHRcdFx0Y29udGVudFNsaWRlID0gJChhY3RpdmUpLmZpbmQoJy5pbnRyb19fc2xpZGUtY29udGVudCcpLmh0bWwoKSxcblx0XHRcdFx0Y29udGVudCA9ICQoc2xpZGVyKS5maW5kKCcuaW50cm9fX2NvbnRlbnQnKSxcblx0XHRcdFx0bGluayA9ICQoYWN0aXZlKS5kYXRhKCdsaW5rJyksXG5cdFx0XHRcdGFsdFNsaWRlID0gJChhY3RpdmUpLmZpbmQoJy5pbnRyb19fc2xpZGUtYWx0JykuaHRtbCgpLFxuXHRcdFx0XHRhbHQgPSAkKHNsaWRlcikuZmluZCgnLmludHJvX19hbHQnKTtcblxuXHRcdFx0JChzbGlkZXIpLmZpbmQoJy5pbnRyb19fc2xpZGUuYWN0aXZlJykucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xuXHRcdFx0JChhY3RpdmUpLmFkZENsYXNzKCdhY3RpdmUnKTtcblxuXHRcdFx0JChjb250ZW50KS5hZGRDbGFzcygnY2hhbmdlJykuaHRtbChjb250ZW50U2xpZGUpO1xuXHRcdFx0JChzbGlkZXIpLmZpbmQoJy5pbnRyb19fbW9yZScpLmF0dHIoJ2hyZWYnLCBsaW5rKTtcblxuXHRcdFx0JChhbHQpLmFkZENsYXNzKCdjaGFuZ2UnKTtcblxuXHRcdFx0Y291bnQoKTtcblxuXHRcdFx0c2V0VGltZW91dChmdW5jdGlvbigpIHtcblx0XHRcdFx0JChhbHQpLnJlbW92ZUNsYXNzKCdjaGFuZ2UnKS5lbXB0eSgpLmFwcGVuZChhbHRTbGlkZSk7XG5cdFx0XHRcdHZhciBnYWxsZXJ5ID0gJChhbHQpLmZpbmQoJy5nYWxsZXJ5JykuZ2V0KDApO1xuXG5cdFx0XHRcdGlmIChnYWxsZXJ5KSB7XG5cdFx0XHRcdFx0JChnYWxsZXJ5KS5maW5kKCcuZ2FsbGVyeV9fc2xpZGVzJykuc2xpY2soe1xuXHRcdFx0XHRcdFx0aW5maW5pdGU6IHRydWUsXG5cdFx0XHRcdFx0XHRhdXRvcGxheTogMzAwMCxcblx0XHRcdFx0XHRcdHNsaWRlc1RvU2hvdzogMSxcblx0XHRcdFx0XHRcdGFycm93czogdHJ1ZSxcblx0XHRcdFx0XHRcdGZhZGU6IHRydWUsXG5cdFx0XHRcdFx0XHRwcmV2QXJyb3c6ICQoJy5jb250cm9sc19nYWxsZXJ5IC5jb250cm9sc19fYXJyb3dfcHJldicpLFxuXHRcdFx0XHRcdFx0bmV4dEFycm93OiAkKCcuY29udHJvbHNfZ2FsbGVyeSAuY29udHJvbHNfX2Fycm93X25leHQnKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9LCA1MDApO1xuXG5cdFx0XHRzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuXHRcdFx0XHQkKGNvbnRlbnQpLnJlbW92ZUNsYXNzKCdjaGFuZ2UnKTtcblx0XHRcdH0sIDMwMCk7XG5cdFx0fVxuXG5cdFx0JChzbGlkZXIpLmZpbmQoJy5pbnRyb19fc2xpZGUnKS5maXJzdCgpLmFkZENsYXNzKCdhY3RpdmUnKTtcblxuXHRcdGFjdGl2ZUNvbnRlbnQoKTtcblxuXHRcdCQoc2xpZGVyKS5maW5kKCcuY29udHJvbHNfX2Fycm93Jykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgZGlyZWN0aW9uID0gJCh0aGlzKS5oYXNDbGFzcygnY29udHJvbHNfX2Fycm93X25leHQnKTtcblx0XHRcdFxuXHRcdFx0c3dpdGNoIChkaXJlY3Rpb24pIHtcblx0XHRcdFx0Y2FzZSB0cnVlOlxuXHRcdFx0XHRcdG5leHRTbGlkZSgpO1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRjYXNlIGZhbHNlOlxuXHRcdFx0XHRcdHByZXZTbGlkZSgpO1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0fVxuXHRcdH0pXG5cblx0XHRpZiAoYXV0b1BsYXlTbGlkZXMpIGF1dG9QbGF5KGF1dG9QbGF5U2xpZGVzU3BlZWQpO1xuXHR9XG5cblx0aW50cm9TbGlkZXIoe1xuXHRcdHNsaWRlcjogJCgnW2RhdGEtc2xpZGVyPVwiaW50cm9cIl0nKSxcblx0XHRhdXRvUGxheTogdHJ1ZSxcblx0XHRhdXRvUGxheVNwZWVkOiA1MDAwXG5cdH0pXG5cblx0aW50cm9TbGlkZXIoe1xuXHRcdHNsaWRlcjogJCgnW2RhdGEtc2xpZGVyPVwic3BlY2lhbGlzdHNcIl0nKVxuXHR9KVxuXG5cdGZ1bmN0aW9uIGJyYW5kc1NsaWRlcigpIHtcblx0XHRmdW5jdGlvbiByZWZyZXNoKCkge1xuXHRcdFx0dmFyIHNsaWRlcyA9ICQoJy5icmFuZHNfX2xpc3QgLmJyYW5kJykuY2hpbGRyZW4oKS5sZW5ndGgrMSxcblx0XHRcdFx0Y3VycmVudCA9ICQoJy5icmFuZC5zbGljay1jdXJyZW50JyksXG5cdFx0XHRcdGluZGV4ID0gJChjdXJyZW50KS5pbmRleCgpKzEsXG5cdFx0XHRcdGltZyA9ICQoY3VycmVudCkuZGF0YSgnaW1hZ2UnKSxcblx0XHRcdFx0aW1hZ2UgPSAkKCcuYnJhbmRzX19pbWFnZScpO1xuXG5cdFx0XHRpZiAoU3RyaW5nKHNsaWRlcykubGVuZ3RoID09PSAxKSBzbGlkZXMgPSAnMCcrc2xpZGVzO1xuXHRcdFx0aWYgKFN0cmluZyhpbmRleCkubGVuZ3RoID09PSAxKSBpbmRleCA9ICcwJytpbmRleDtcblxuXHRcdFx0JCgnLmJyYW5kc19fY291bnQgc3BhbicpLmZpcnN0KCkudGV4dChpbmRleCk7XG5cdFx0XHQkKCcuYnJhbmRzX19jb3VudCBzcGFuJykubGFzdCgpLnRleHQoc2xpZGVzKTtcblxuXHRcdFx0JChpbWFnZSkuYWRkQ2xhc3MoJ2NoYW5nZScpO1xuXG5cdFx0XHRzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuXHRcdFx0XHQkKGltYWdlKS5jc3Moe1xuXHRcdFx0XHRcdCdiYWNrZ3JvdW5kLWltYWdlJzogJ3VybCgnK2ltZysnKSdcblx0XHRcdFx0fSlcblx0XHRcdFx0JChpbWFnZSkucmVtb3ZlQ2xhc3MoJ2NoYW5nZScpO1xuXHRcdFx0fSwgMTAwKVxuXHRcdH1cblxuXHRcdCQoJy5icmFuZHNfX2xpc3QnKS5zbGljayh7XG5cdFx0XHRpbmZpbml0ZTogdHJ1ZSxcblx0XHRcdGZhZGU6IHRydWUsXG5cdFx0XHRhcnJvd3M6IHRydWUsXG5cdFx0XHRwcmV2QXJyb3c6ICQoJy5jb250cm9sc19icmFuZHMgLmNvbnRyb2xzX19hcnJvd19wcmV2JyksXG5cdFx0XHRuZXh0QXJyb3c6ICQoJy5jb250cm9sc19icmFuZHMgLmNvbnRyb2xzX19hcnJvd19uZXh0Jylcblx0XHR9KTtcblx0XHRcblx0XHQkKCcuY29udHJvbHNfYnJhbmRzIC5jb250cm9sc19fYXJyb3cnKS5vbignY2xpY2snLCByZWZyZXNoKTtcblxuXHRcdHJlZnJlc2goKTtcblx0fVxuXG5cdGJyYW5kc1NsaWRlcigpO1xuXG5cdGZ1bmN0aW9uIGdhbGxlcnkoKSB7XG5cdFx0JCgnLmdhbGxlcnknKS5lYWNoKGZ1bmN0aW9uKGksIGdhbGxlcnkpIHtcblx0XHRcdGlmICgkKGdhbGxlcnkpLmhhc0NsYXNzKCdnYWxsZXJ5X3NwZWMnKSkgcmV0dXJuO1xuXG5cdFx0XHQkKGdhbGxlcnkpLmZpbmQoJy5nYWxsZXJ5X19zbGlkZXMnKS5zbGljayh7XG5cdFx0XHRcdGluZmluaXRlOiB0cnVlLFxuXHRcdFx0XHRhdXRvcGxheTogMzAwMCxcblx0XHRcdFx0c2xpZGVzVG9TaG93OiAxLFxuXHRcdFx0XHRhcnJvd3M6IHRydWUsXG5cdFx0XHRcdGZhZGU6IHRydWUsXG5cdFx0XHRcdHByZXZBcnJvdzogJCgnLmNvbnRyb2xzX2dhbGxlcnkgLmNvbnRyb2xzX19hcnJvd19wcmV2JyksXG5cdFx0XHRcdG5leHRBcnJvdzogJCgnLmNvbnRyb2xzX2dhbGxlcnkgLmNvbnRyb2xzX19hcnJvd19uZXh0Jylcblx0XHRcdH0pO1xuXG5cdFx0XHRmdW5jdGlvbiB0aXRsZVNldHVwKHRpdGxlKSB7XG5cdFx0XHRcdHZhciBkZWxheSA9IDE1MDtcblx0XHRcdFx0XG5cdFx0XHRcdCQodGl0bGVzKS5mYWRlT3V0KGRlbGF5LCBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHQkKHRoaXMpLmh0bWwodGl0bGUpLmZhZGVJbihkZWxheSlcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdHZhciB0aXRsZXMgPSAkKGdhbGxlcnkpLmZpbmQoJy5nYWxsZXJ5X190aXRsZScpLmdldCgwKTtcblxuXHRcdFx0aWYgKHRpdGxlcykge1xuXHRcdFx0XHR2YXIgdGl0bGUgPSAkKGdhbGxlcnkpLmZpbmQoJy5zbGljay1jdXJyZW50JykuZGF0YSgndGl0bGUnKTtcblx0XHRcdFx0dGl0bGVTZXR1cCh0aXRsZSk7XG5cblx0XHRcdFx0JChnYWxsZXJ5KS5maW5kKCcuZ2FsbGVyeV9fc2xpZGVzJykub24oJ2JlZm9yZUNoYW5nZScsIGZ1bmN0aW9uKGUsIHNsaWNrLCBjdXJyZW50U2xpZGUsIG5leHRTbGlkZSkge1xuXHRcdFx0XHRcdHZhciBpbmRleCA9IG5leHRTbGlkZSxcblx0XHRcdFx0XHRcdHNsaWRlID0gJChnYWxsZXJ5KS5maW5kKCcuZ2FsbGVyeV9faXRlbScpLmdldChpbmRleCksXG5cdFx0XHRcdFx0XHR0aXRsZSA9ICQoc2xpZGUpLmRhdGEoJ3RpdGxlJyk7XG5cblx0XHRcdFx0XHR0aXRsZVNldHVwKHRpdGxlKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0XHRcblx0XHR9KTtcblx0fVxuXG5cdGdhbGxlcnkoKTtcblxuXG5cdC8vINCf0YDQvtGB0YLRi9C1INGB0LvQsNC50LTQtdGA0Ytcblx0JCgnLnNsaWRlcicpLmVhY2goZnVuY3Rpb24oaSwgc2xpZGVyKSB7XG5cdFx0dmFyIHNsID0gJChzbGlkZXIpLmZpbmQoJy5zbGlkZXJfX2xpc3QnKTtcblxuXHRcdHNsLnNsaWNrKHtcblx0XHRcdHZhcmlhYmxlV2lkdGg6IHRydWUsXG5cdFx0XHRjZW50ZXJNb2RlOiB0cnVlLFxuXHRcdFx0YXJyb3dzOiB0cnVlLFxuXHRcdFx0cHJldkFycm93OiAkKHNsaWRlcikuZmluZCgnLmNvbnRyb2xzX19hcnJvd19wcmV2JyksXG5cdFx0XHRuZXh0QXJyb3c6ICQoc2xpZGVyKS5maW5kKCcuY29udHJvbHNfX2Fycm93X25leHQnKVxuXHRcdH0pXG5cblx0XHR2YXIgYmlnSW1nID0gJChzbGlkZXIpLmRhdGEoJ2JpZ2ltZycpO1xuXG5cdFx0aWYgKGJpZ0ltZykge1xuXHRcdFx0dmFyIGJpZyA9ICQoJy4nK2JpZ0ltZykuZ2V0KDApO1xuXG5cdFx0XHQkKGJpZykuaHRtbCgkKHNsKS5maW5kKCcuc2xpY2stY3VycmVudCBpbWcnKS5jbG9uZSgpKTtcblxuXHRcdFx0JChzbCkub24oJy5zbGlkZXJfX2l0ZW0nKS5vbignY2xpY2snLCBmdW5jdGlvbihlKSB7XG5cdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblxuXHRcdFx0XHR2YXIgaW1nID0gJCh0aGlzKS5maW5kKCdpbWcnKS5jbG9uZSgpO1xuXG5cdFx0XHRcdCQoYmlnKS5lbXB0eSgpLmh0bWwoaW1nKTtcblx0XHRcdH0pXG5cdFx0fVxuXHR9KTtcblxuXHQvLyBicG9wdXBcblx0JCgnW2RhdGEtYnBvcHVwXScpLm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcblx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cblx0XHR2YXIgaW1nID0gJCh0aGlzKS5maW5kKCdpbWcnKS5jbG9uZSgpLFxuXHRcdFx0aW1nV3JhcCA9ICc8ZGl2IGNsYXNzPVwiYnBvcHVwLXdyYXAtaW1hZ2VcIj48L2Rpdj4nO1xuXG5cdFx0JCgnYm9keScpLmFwcGVuZChpbWdXcmFwKTtcblx0XHQkKGltZ1dyYXApLmFwcGVuZChpbWcpLmJQb3B1cCgpLnJlcG9zaXRpb24oMzAwKTtcblx0XHRcblxuXHR9KVxuXG5cdC8vINCa0LDRgNGC0LBcblx0dmFyIG1hcCA9ICQoJyNtYXAnKS5nZXQoMCk7XG5cblx0aWYgKG1hcCkge1xuXHRcdHltYXBzLnJlYWR5KGluaXQpO1xuXG5cdCAgICB2YXIgbXlNYXAsIFxuXHQgICAgICAgIG15UGxhY2VtYXJrO1xuXG5cdCAgICBmdW5jdGlvbiBpbml0KCl7IFxuXHQgICAgICAgIG15TWFwID0gbmV3IHltYXBzLk1hcChcIm1hcFwiLCB7XG5cdCAgICAgICAgICAgIGNlbnRlcjogWzUzLjMzNDEzNiwgODMuNzkzMjQ3XSxcblx0ICAgICAgICAgICAgem9vbTogMTcsXG5cdCAgICAgICAgICAgIGNvbnRyb2xzOiBbXVxuXHQgICAgICAgIH0pOyBcblx0ICAgICAgICBcblx0ICAgICAgICBteVBsYWNlbWFyayA9IG5ldyB5bWFwcy5QbGFjZW1hcmsoWzUzLjMzNDEzNiwgODMuNzkzMjQ3XSwge1xuXHQgICAgICAgICAgICBoaW50Q29udGVudDogJ9Ci0JQgVWx0cmEnXG5cdCAgICAgICAgfSk7XG5cdCAgICAgICAgXG5cdCAgICAgICAgbXlNYXAuZ2VvT2JqZWN0cy5hZGQobXlQbGFjZW1hcmspO1xuXHQgICAgfVxuXHR9XG5cblx0Ly8g0JrRgNCw0YHQuNCy0YvQtSDRgdC10LvQtdC60YLRi1xuXHQkKCdzZWxlY3QnKS5uaWNlU2VsZWN0KCk7XG5cblx0Ly8g0JzQvtCx0LjQu9GM0L3QvtC1INC80LXQvdGOXG5cdCQoJy5tZW51Jykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG5cdFx0JCh0aGlzKS5wYXJlbnQoKS50b2dnbGVDbGFzcygnbWVudS1vcGVuJyk7XG5cdH0pO1xuXG5cdC8vINCc0L7QtNCw0LvRjNC90YvQtSDQvtC60L3QsFxuXHQkKCdbZGF0YS1vcGVuXScpLm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcblx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cblx0XHR2YXIgbW9kYWwgPSAkKCdbZGF0YS1tb2RhbD1cIicrJCh0aGlzKS5kYXRhKCdvcGVuJykrJ1wiXScpLmdldCgwKTtcblxuXHRcdCQobW9kYWwpLmJQb3B1cCh7XG5cdFx0XHRjbG9zZUNsYXNzOiAnbW9kYWxfX2Nsb3NlJ1xuXHRcdH0pO1xuXHR9KTtcblxuXHQvLyDQn9C+0LjRgdC6XG5cdHNlYXJjaENvbXBvbmVudCgpO1xuXG5cdGZ1bmN0aW9uIHNlYXJjaENvbXBvbmVudCgpIHtcblx0XHR2YXIgc2VhcmNoID0gJCgnLnNlYXJjaCcpO1xuXG5cdFx0JCgnLnNlYXJjaF9fYnRuJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG5cdFx0XHRpZiAoJCh3aW5kb3cpLndpZHRoKCkgPiA3NjgpIHJldHVybjtcblxuXHRcdFx0JChzZWFyY2gpLnRvZ2dsZUNsYXNzKCdzZWFyY2gtb3BlbicpO1xuXHRcdFx0JChzZWFyY2gpLmZpbmQoJ2lucHV0JykuZm9jdXMoKTtcblx0XHR9KTtcblxuXHRcdCQoJy5zZWFyY2hfX2NsZWFyJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG5cdFx0XHQkKHNlYXJjaCkuZmluZCgnLnNlYXJjaF9fZmllbGQgaW5wdXQnKS52YWwoJycpLmZvY3VzKCk7XG5cdFx0fSk7XG5cdH1cblxuXHQvLyDQodGA0LDQstC90LXQvdC40LVcblx0JCgnLnJlc3VsdF9fY29tcGFyZScpLnR3ZW50eXR3ZW50eSh7XG5cdFx0YmVmb3JlX2xhYmVsOiAn0JTQvicsXG5cdFx0YWZ0ZXJfbGFiZWw6ICfQn9C+0YHQu9C1J1xuXHR9KTtcblxuXHQvLyB0aWx0IGpzXG5cdCQoJy5zZXJ0aWZpY2F0ZScpLnRpbHQoKTtcblxuXHQvLyDQn9C70LDQstCw0Y7RidCw0Y8g0YjQsNC/0LrQsFxuXHQkKCdib2R5JykuYXBwZW5kKCQoJy5oZWFkZXJfX21haW4nKS5jbG9uZSgpLmFkZENsYXNzKCdmaXhlZCcpKTtcblxuXHQkKHdpbmRvdykub24oJ3Njcm9sbCcsIGZ1bmN0aW9uKCkge1xuXHRcdGlmICgkKHdpbmRvdykud2lkdGgoKSA8PSAxMDAwKSB7XG5cdFx0XHQkKCcuaGVhZGVyX19tYWluLmZpeGVkLnNob3cnKS5yZW1vdmVDbGFzcygnc2hvdycpO1xuXHRcdFx0cmV0dXJuXG5cdFx0fVxuXG5cdFx0dmFyIHNjcm9sbCA9ICQod2luZG93KS5zY3JvbGxUb3AoKTtcblxuXHRcdGlmIChzY3JvbGwgPj0gMjAwKSB7XG5cdFx0XHQkKCcuaGVhZGVyX19tYWluLmZpeGVkJykuYWRkQ2xhc3MoJ3Nob3cnKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0JCgnLmhlYWRlcl9fbWFpbi5maXhlZC5zaG93JykucmVtb3ZlQ2xhc3MoJ3Nob3cnKTtcblx0XHR9XG5cdH0pO1xuXG59KTsiXX0=
